---
# tasks file for aws-ec2-openldap

#========================= GATHER VPC INFO ==================== TAG: always =======================
- name: get VPC info
  ec2_vpc_net_info:
    filters:
      "tag:Name": ANS0905-VPC #TEMPLATE
    region: us-east-1 #TEMPLATE
  register: vpcs
  tags: always

- name: display vpc-id
  debug: 
    var: vpcs
  tags: always

#====================== GATHER SUBNET INFO ===================== TAG: always ======================
- name: get subnet info
  ec2_vpc_subnet_info:
    filters: 
      "tag:Name": ANS0905-SUBNET #TEMPLATE
      vpc-id: "{{ vpcs.vpcs[0].id }}"
    region: us-east-1 #TEMPLATE
  register: aws_subnets
  tags: always
- debug: 
    var: aws_subnets.subnets[0].id
  tags: always  

#====================== GATHER SEC GROUP INFO ================= TAG: always =====================
- name: get secuirty group info
  ec2_group_info: 
    filters:
      "tag:Name": ANS0905-SECGRP #TEMPLATE
      vpc-id: "{{ vpcs.vpcs[0].id }}" 
    region: us-east-1 #TEMPLATE
  register: aws_groups
  tags: always
- debug: 
    var: aws_groups.security_groups[0].group_id
  tags: always